FROM stono/hawkeye:latest

# Install hawkeye
RUN mkdir -p /app
WORKDIR /app
ENTRYPOINT ["node", "oneshot.js"]

RUN groupadd hawkeye && \
    useradd -g hawkeye hawkeye

# If we ever change the hawkeye version, redo everything below
ARG HE_VERSION=
RUN yum -y -q update && \
    yum -y -q clean all

COPY package.json /app

RUN cd /app && \
    npm install --quiet --production

COPY ./ /app

RUN find . -type d \( -path ./node_modules \) -prune -o -exec chown hawkeye:hawkeye {} \;
USER hawkeye
